<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InovMed | Dashboards</title>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="./js/municipal.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="./css/municipal.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="assets/icon/logo fundo azul.png" type="image/x-icon">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="validarSessao(); listar2()">

    <div class="janela">

        <div class="header-left">
            <img src="./assets/imgs/logo plus branca sem fundo.png" alt="Logo InovMed" class="logo" />

            <div class="nav-icons">
                <div class="btn-nav-white active" onclick="abrirDashboard()">
                    <i class="fas fa-chart-bar"></i>
                </div>

                <div class="btn-nav" onclick="abrirPerfil()">
                    <i class="fa-solid fa-circle-user"></i>
                </div>

                <div class="btn-nav-white" id="novo_user" onclick="abrirConfiguracoes()">
                    <i class="fas fa-gear"></i>
                </div>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
                <i class="fa-solid fa-power-off"></i>
            </div>

        </div>

        <div class="dash-municipal" id="dash_municipal">
            <div class="header-dashboard">
                <h1 class="titulo-dashboard">
                    Olá, <span id="nomeUsuario"></span>!
                </h1>
                <div class="periodo-atual">
                    <p id="titulo-periodo-atual">
                        Período atual:
                    </p>
                    <p>
                        dd/mm/aaaa
                    </p>
                </div>
            </div>
            <div class="conteudo-dashboard-municipal">
                <div class="grupo-kpi">
                    <div class="kpi-container">
                        <h3 class="kpi-titulo">Quantidade de população que sofre com asma
                        </h3>
                        <p class="kpi-valor1">XPTO</p>
                        
                    </div>
                    <div class="kpi-container">
                        <h3 class="kpi-titulo">% da população com asma atendida com base na quantidade de medicamento disponível
                        </h3>
                        <p class="kpi-valor1">XPTO</p>
                        
                    </div>
                    <div class="kpi-container">
                        <h3 class="kpi-titulo">Meses com mais consumo de medicamentos
                        </h3>
                        <p class="kpi-valor1">XPTO</p>
                        
                    </div>
                    <!-- Final KPIs -->

                </div>

                <div class="grupo-grafico">
                    <div class="grafico-container">
                        <canvas id="graficoTendencia"></canvas>
                    </div>
                    <div class="grafico-container">
                        <canvas id="graficoBarras"></canvas>
                    </div>
                    <div class="grafico-container">
                        <canvas id="graficoTendenciaResumo"></canvas>
                    </div>
                    <div class="grafico-container">
                        <canvas id="graficoVencimento"></canvas>
                    </div>
                </div>
            </div>

        </div>

        <div class="dash-perfil" id="dash_perfil">
            <div class="div_animacao">
                <h1 id="title_hello">Seu perfil</h1>
            </div>
            <div class="perfil-container">
                <h2 class="subtitulo">Dados Pessoais</h2>

                <div class="input-group">
                    <div class="input-item">
                        <label for="nome">Nome Completo</label>
                        <i class="fa fa-user"></i>
                        <input type="text" id="nome" class="input-field" disabled>
                    </div>

                    <div class="input-item">
                        <label for="email">E-mail</label>
                        <i class="fa fa-envelope"></i>
                        <input type="email" id="email" class="input-field" disabled>
                    </div>

                    <div class="input-item">
                        <label for="cpf">CPF</label>
                        <i class="fa fa-id-card"></i>
                        <input type="text" maxlength="11" id="cpf" class="input-field" disabled>
                    </div>

                    <div class="input-item">
                        <label for="cargo">Cargo Exercido</label>
                        <i class="fa fa-briefcase"></i>
                        <select id="cargo" class="input-field" disabled>
                            <option value="outros"></option>
                            <option value="coordenador_estadual">Coordenador Estadual</option>
                            <option value="coordenador_municipal">Coordenador Municipal</option>
                        </select>
                    </div>

                    <div class="input-item">
                        <label for="estado">Estado em que atua</label>
                        <i class="fa fa-map-marker-alt"></i>
                        <select id="estado" class="input-field" disabled>
                            <option value="outros"></option>
                            <option value="1">Acre</option>
                            <option value="2">Amapá</option>
                            <option value="3">Amazonas</option>
                            <option value="4">Pará</option>
                            <option value="5">Rondônia</option>
                            <option value="6">Roraima</option>
                            <option value="7">Tocantins</option>
                        </select>
                    </div>
                    <div id="input_item_municipio" class="input-item">
                        <label for="municipio">Município em que atua</label>
                        <i class="fa fa-map-marker-alt"></i> <!-- Ícone para municipio -->
                        <select id="municipio" class="input-field" disabled>
                        </select>
                    </div>
                    <div class="input-item">
                        <label for="nascimento">Data de Nascimento</label>
                        <i class="fa fa-map-marker-alt"></i>
                        <input type="date" id="nascimento" class="input-field" disabled>
                    </div>
                    <div class="input-item">
                        <label for="genero">Gênero</label>
                        <i class="fa fa-map-marker-alt"></i>
                        <select id="genero" name="genero" class="input-field" disabled>
                            <option value="">Selecione</option>
                            <option value="masculino">Masculino</option>
                            <option value="feminino">Feminino</option>
                            <option value="outro">Outro</option>
                            <option value="nao_informar">Prefiro não informar</option>
                        </select>
                    </div>
                    <div class="input-item">
                        <label for="senha">Senha</label>
                        <i class="fa fa-lock"></i>
                        <input type="password" id="senha" class="input-field" disabled>
                    </div>
                </div>
                <div class="botoes-acoes">
                    <button class="btn-descartar" id="btn-descartar" onclick="descartarEdicao()" style="display: none;">
                        <i class="fas fa-times"></i> Descartar
                    </button>
                    <button class="btn-editar" id="btn-editar" onclick="editarInformacoes()">
                        <i class="fas fa-pen"></i> Editar Informações
                    </button>

                    <button class="btn-salvar" id="btn-salvar" onclick="salvarInformacoes()" style="display: none;">
                        <i class="fas fa-save"></i> Salvar Informações
                    </button>
                </div>
                <button class="delete-btn" onclick="excluirConta()">Excluir Conta</button>
            </div>
        </div>

        <div id="modal-confirm" class="modal-overlay hidden">
            <div class="modal-box">
                <h2>Tem certeza que deseja excluir sua conta?</h2>
                <p>Você não irá mais ter acessos à nossa plataforma e aos dados aqui inclusos</p>
                <div class="modal-buttons">
                    <button id="cancel-delete" class="btn cancelar">Cancelar</button>
                    <button id="confirm-delete" class="btn confirmar">Excluir Conta</button>
                </div>
            </div>
        </div>

        <div class="dash-config" id="dash_config">
            <div class="titulo-config">
                <h1>Configurações</h1>
            </div>

            <div class="opcao-config-container" id="opcao_config_container">
                <div class="opcao-config-contato" onclick="abrirContatos()">
                    <div class="texto-config">
                        <h1>
                            Contato
                        </h1>
                        <p>
                            Defina onde é importante você receber notificações sobre alertas e avisos
                        </p>
                    </div>
                    <div class="config-seta-imagem">
                        <img src="assets/icon/caret-right-light.png">
                    </div>
                </div>
                <div class="opcao-config-parametro" onclick="abrirParametros()">
                    <div class="texto-config">
                        <h1>
                            Parâmetros
                        </h1>
                        <p>
                            Defina os parâmetros e métricas que façam sentido com sua realidade
                        </p>
                    </div>
                    <div class="config-seta-imagem">
                        <img src="assets/icon/caret-right-light.png">
                    </div>
                </div>
            </div>

            <div class="dash-contato-container" id="dash_contato_container">
                <h1 class="titulo-contato">
                    Contatos
                </h1>
                <div class="contato-container">
                    <div class="contato-container-cima">
                        <h1 class="nome-contato" id="nome_contato">
                            Contato 1
                        </h1>
                        <div class="excluir-contato">
                            <img src="assets/icon/trash.png">
                        </div>
                    </div>
                    <div class="contato-container-input">
                        <p class="email-contato">
                            Email
                        </p>
                        <input type="text" id="input_email_contato">
                    </div>
                    <div class="botoes-acoes-contato">
                        <button class="btn-editar" id="btn-editar" onclick="editarInformacoes()">
                            <i class="fas fa-pen"></i> Editar Informações
                        </button>
                        <button class="btn-descartar" id="btn-descartar" onclick="descartarEdicao()"
                            style="display: none;">
                            <i class="fas fa-times"></i> Descartar
                        </button>
                        <button class="btn-salvar" id="btn-salvar" onclick="salvarInformacoes()"
                            style="display: none;">
                            <i class="fas fa-save"></i> Salvar Informações
                        </button>
                    </div>
                </div>
                <div class="adicionar-contato">
                    <div id="adicionar_contato">
                        <img src="assets/icon/plus-circle-thin.png">
                    </div>
                </div>
            </div>

            <div class="dash-parametro-container" id="dash_parametro_container">
                <h1 class="titulo-parametro">
                    Parâmetros
                </h1>
                <div class="parametro-container">
                    <h1 class="nome-parametro">
                        Medicamentos
                    </h1>
                    <div class="parametro-container-input">
                        <p class="menor-valor-parametro">
                            Menor quantidade (unidades)
                        </p>
                        <input type="text" id="input_parametro_menor_valor" disabled>
                        <p class="descricao-input-parametro">
                            Caso a quantidade de medicamentos esteja menor que esse valor, te notificaremos
                        </p>
                        <p class="maior-valor-parametro">
                            Maior quantidade (unidades)
                        </p>
                        <input type="text" id="input_parametro_maior_valor" disabled>
                        <p class="descricao-input-parametro">
                            Caso a quantidade de medicamentos esteja maior que esse valor, te notificaremos
                        </p>
                    </div>
                    <div class="botoes-acoes-parametros">
                        <button class="btn-editar" id="btn-editar-parametro" onclick="editarInformacoesParametro()">
                            <i class="fas fa-pen"></i> Editar Informações
                        </button>
                        <button class="btn-descartar" id="btn-descartar-parametro" onclick="descartarEdicaoParametro()"
                            style="display: none;">
                            <i class="fas fa-times"></i> Descartar
                        </button>
                        <button class="btn-salvar" id="btn-salvar-parametro" onclick="salvarInformacoesParametro()"
                            style="display: none;">
                            <i class="fas fa-save"></i> Salvar Informações
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // GRÁFICO DE BARRAS
            const ctxBarras = document.getElementById('graficoBarras').getContext('2d');
            const graficoBarras = new Chart(ctxBarras, {
                type: 'bar',
                data: {
                    labels: ['Remédio 1', 'Remédio 2', 'Remédio 3', 'Remédio 4'],
                    datasets: [
                        {
                            label: 'Período Anterior',
                            data: [60, 70, 85, 90],
                            backgroundColor: 'rgb(255, 99, 132)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Período Atual',
                            data: [80, 125, 100, 130],
                            backgroundColor: 'rgba(54, 162, 235)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparação de quantidade de remédios por período',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            min: 0,
                            max: 140,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            });

            // GRÁFICO DE TENDÊNCIA
            const ctxTendencia = document.getElementById('graficoTendencia').getContext('2d');
            const graficoTendencia = new Chart(ctxTendencia, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [
                        {
                            label: 'Remédio X',
                            data: [30, 35, 40, 45, 50, 48, 47, 49, 52, 54, 58, 60],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'transparent',
                            tension: 0.3,
                            borderWidth: 2,
                            pointRadius: 0,
                        },
                        {
                            label: 'Remédio Y',
                            data: [20, 25, 28, 30, 35, 36, 33, 34, 38, 40, 42, 45],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'transparent',
                            borderDash: [5, 5],
                            tension: 0.3,
                            borderWidth: 2,
                            pointRadius: 0,
                        },
                        {
                            label: 'Remédio Z',
                            data: [10, 15, 18, 20, 22, 21, 19, 22, 24, 26, 28, 30],
                            borderColor: 'rgba(255, 206, 86, 1)',
                            backgroundColor: 'transparent',
                            tension: 0.3,
                            borderWidth: 2,
                            pointRadius: 0,
                        },
                        {
                            label: 'Media pessoas com asma',
                            data: [25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25],
                            borderColor: 'rgba(75, 192, 192, )',
                            borderDash: [10, 5],
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            pointRadius: 0,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Histórico mensal de medicamentos comprados por mês',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 15,
                                padding: 10
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade',
                                font: {
                                    weight: 'bold',
                                    size: 14
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Meses',
                                font: {
                                    weight: 'bold',
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });

            // GRÁFICO DE VENCIMENTO DE LOTES
            // GRÁFICO DE VENCIMENTO DE LOTES
            const ctxVencimento = document.getElementById('graficoVencimento').getContext('2d');

            const lotes = [
                { nome: 'Lote A', remedio: 'Remédio X', vencimento: '2025-05-01', quantidade: 50 },
                { nome: 'Lote B', remedio: 'Remédio Y', vencimento: '2025-05-10', quantidade: 30 },
                { nome: 'Lote C', remedio: 'Remédio Z', vencimento: '2025-05-15', quantidade: 40 },
                { nome: 'Lote D', remedio: 'Remédio X', vencimento: '2025-05-20', quantidade: 20 },
                { nome: 'Lote E', remedio: 'Remédio Y', vencimento: '2025-05-25', quantidade: 60 }
            ];

            // Ordenar por data de vencimento
            lotes.sort((a, b) => new Date(a.vencimento) - new Date(b.vencimento));
            const labelsVenc = lotes.map(l => l.vencimento);
            const dataVenc = lotes.map(l => l.quantidade);
            const infoVenc = lotes.map(l => `${l.nome} - ${l.remedio}`);

            // Cores diferentes para cada barra
            const cores = [
                'rgba(255, 99, 132, 0.6)',
                'rgba(54, 162, 235, 0.6)',
                'rgba(255, 206, 86, 0.6)',
                'rgba(75, 192, 192, 0.6)',
                'rgba(153, 102, 255, 0.6)'
            ];
            const coresBorda = cores.map(c => c.replace('0.6', '1'));

            const graficoVencimento = new Chart(ctxVencimento, {
                type: 'bar',
                data: {
                    labels: labelsVenc,
                    datasets: [{
                        label: 'Quantidade por Lote',
                        data: dataVenc,
                        backgroundColor: cores,
                        borderColor: coresBorda,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Remédios Próximos ao Vencimento',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const quantidade = context.raw;
                                    const info = infoVenc[context.dataIndex];
                                    return `${info}: ${quantidade} unidades`;
                                }
                            }
                        },
                        legend: {
                            labels: {
                                generateLabels: function () {
                                    // Exibe as legendas como os lotes/remédios
                                    return infoVenc.map((info, index) => ({
                                        text: info,
                                        fillStyle: cores[index],
                                        strokeStyle: coresBorda[index],
                                        lineWidth: 1,
                                        hidden: false,
                                        index: index
                                    }));
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade',
                                font: {
                                    weight: 'bold',
                                    size: 14
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Data de Vencimento',
                                font: {
                                    weight: 'bold',
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });

            const ctxTendencia2 = document.getElementById('graficoTendenciaResumo').getContext('2d');

            const graficoTendencia2 = new Chart(ctxTendencia2, {
                type: 'line',
                data: {
                    labels: ['Mês Anterior', 'Mês Atual', 'Próximo Mês'],
                    datasets: [
                        {
                            label: 'Remédio X',
                            data: [80, 90, 120],
                            borderColor: 'rgba(30, 144, 255, 1)',  // Azul Médio Escuro
                            borderWidth: 2,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: 'rgba(173, 216, 230, 1)'  // Azul Claro
                        },
                        {
                            label: 'Remédio Y',
                            data: [90, 60, 70],
                            borderColor: 'rgba(34, 139, 34, 1)',  // Verde Médio Escuro
                            borderWidth: 2,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: 'rgba(144, 238, 144, 1)'  // Verde Claro
                        },
                        {
                            label: 'Remédio Z',
                            data: [20, 40, 65],
                            borderColor: 'rgba(255, 204, 0, 1)',  // Amarelo Médio Escuro
                            borderWidth: 2,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: 'rgba(255, 255, 102, 1)'  // Amarelo Claro
                        }

                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Tendência de Compra por Remédio',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 20,
                                padding: 10
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade Comprada',
                                font: {
                                    weight: 'bold',
                                    size: 14
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Período',
                                font: {
                                    weight: 'bold',
                                    size: 14
                                }
                            },
                            ticks: {
                                autoSkip: false,

                            },

                        }
                    }
                }
            });

        });



    </script>


</body>

</html>
<script src="./js/sessao.js"></script>
<script>
    nomeUsuario.innerHTML = sessionStorage.NOME_USUARIO;

    nome.value = sessionStorage.NOME_USUARIO;
    email.value = sessionStorage.EMAIL_USUARIO;
    cpf.value = sessionStorage.CPF_USUARIO;
    cargo.value = sessionStorage.CARGO_USUARIO;
    genero.value = sessionStorage.GENERO_USUARIO;
    senha.value = sessionStorage.SENHA_USUARIO;
    estado.value = sessionStorage.FK_ESTADO;
    function listar2(fkEstado) {
            var fkEstado = document.getElementById('estado').value;
            fetch(`/municipios/listar/${fkEstado}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                },
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO listar()!");

                if (resposta.ok) {
                    console.log(resposta);
                    resposta.json().then(json => {
                        console.log(json); // Verifique o conteúdo retornado
                        if (json.length > 0) {
                            console.log("Número de usuários:", json.length);
                            
                            municipio.innerHTML = "";

                            for (let i = 0; i < json.length; i++) {
                                municipio.innerHTML += `
                            <option value="${json[i].idMunicipio}">${json[i].nome}</option>
                        `
                            }
                            municipio.value = sessionStorage.FK_MUNICIPIO;
                        } else {
                            console.log("Nenhum município encontrado.");
                        }
                    });

                } else {
                    console.log("Houve um erro ao tentar realizar a listagem!");
                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            });
        }
    

    var dataCompleta = new Date(sessionStorage.DT_NASC);
    var dia = String(dataCompleta.getDate()).padStart(2, '0');
    var mes = String(dataCompleta.getMonth() + 1).padStart(2, '0');
    var ano = dataCompleta.getFullYear();
    var dataFormatada = `${ano}-${mes}-${dia}`;

    nascimento.value = dataFormatada;
    
</script>
</html>
